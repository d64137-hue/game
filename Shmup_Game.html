<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Shmup_Game.html (Ë£ΩÂìÅÁâà v6 - „Éë„ÉØ„Éº„Ç¢„ÉÉ„Éó & WaveÂà∂)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        body { 
            background: #2a2a2a; 
            color: white; 
            text-align: center; 
            font-family: sans-serif; 
            margin: 0; 
            padding-top: 20px; 
            padding-bottom: 50px; 
            overflow-y: auto;
        }
        h1 {
            color: #76FF03; 
            margin-bottom: 20px;
        }
        #GameArea {
            max-width: 600px; 
            margin: 0 auto;
            padding: 20px;
            border: 1px solid #444;
            border-radius: 8px;
            background: #1e1e1e;
        }
        #GameCanvas {
            background: #00001a;
            border: 2px solid #FFC300;
            display: block;
            margin: 20px auto;
            cursor: pointer; 
            touch-action: none; 
        }
        #ui-panel {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            font-size: 1.1em;
            color: #FFC300;
        }
        .ui-item {
            margin: 0 10px;
        }
        button {
            padding: 10px 20px;
            font-size: 1.0em;
            background-color: #76FF03;
            color: black;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 15px;
        }
        #game-over-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 2em;
            text-shadow: 2px 2px 5px black;
            z-index: 10;
            display: none; 
        }
        #final-score-display {
            font-size: 1.5em;
            margin-bottom: 20px;
            color: #FFC300;
        }
        #score-display {
            color: white;
        }
        #power-display {
            color: #FFC300;
        }
        #wave-display {
            color: #76FF03;
        }
    </style>
</head>
<body>
    <div id="GameArea">
        <h1>Shmup_Game.html (Ë£ΩÂìÅÁâà v6)</h1>
        
        <div id="ui-panel">
            <div class="ui-item">WAVE: <span id="wave-display">1</span></div>
            <div class="ui-item">SCORE: <span id="score-display">0</span></div>
            <div class="ui-item">POWER: <span id="power-display">P0</span></div>
        </div>

        <canvas id="GameCanvas" width="500" height="650"></canvas>
        
        <div id="game-over-screen">
            <h2>GAME OVER</h2>
            <div id="final-score-display">ÊúÄÁµÇ„Çπ„Ç≥„Ç¢: 0</div>
            <button onclick="retryGame()">„É™„Éà„É©„Ç§</button>
        </div>
    </div>
    
    <script>
        const canvas = document.getElementById('GameCanvas');
        const ctx = canvas.getContext('2d');
        const WIDTH = canvas.width; 
        const HEIGHT = canvas.height; 

        // --- „Ç≤„Éº„É†Áä∂ÊÖãÂ§âÊï∞ ---
        let gameStatus = 'playing'; 
        let keys = {};
        let player = {};
        let bullets = [];
        let enemies = [];
        let enemyBullets = [];
        let items = []; // ‚òÖËøΩÂä†: „Ç¢„Ç§„ÉÜ„É†ÈÖçÂàó

        let score = 0; // ‚òÖËøΩÂä†: „Çπ„Ç≥„Ç¢
        let powerLevel = 0; // ‚òÖËøΩÂä†: „Éë„ÉØ„Éº„Ç¢„ÉÉ„Éó„É¨„Éô„É´
        let currentWave = 1; // ‚òÖËøΩÂä†: Wave
        let enemySpawnTimer = 0; // ‚òÖËøΩÂä†: Êïµ„ÅÆÂá∫ÁèæÁÆ°ÁêÜ
        let enemiesToSpawn = 0; // ‚òÖËøΩÂä†: „Åù„ÅÆWave„ÅßÂá∫Áèæ„Åï„Åõ„ÇãÊïµ„ÅÆÁ∑èÊï∞
        let enemiesSpawned = 0; // ‚òÖËøΩÂä†: „Åô„Åß„Å´Âá∫Áèæ„Åï„Åõ„ÅüÊïµ„ÅÆÊï∞

        const PLAYER_SPEED = 4;
        const PLAYER_SLOW_SPEED = 1.5;

        // --- „ÇØ„É©„ÇπÂÆöÁæ© ---

        class Player {
            constructor() {
                this.width = 40; this.height = 40;
                this.x = WIDTH / 2 - this.width / 2; this.y = HEIGHT - 60;
                this.hitboxRadius = 2; 
                this.color = '#76FF03';
                this.fireRate = 10; // Âü∫Á§éÈÄ£Â∞ÑÈñìÈöîÔºà„Éï„É¨„Éº„É†Êï∞Ôºâ
                this.fireTimer = 0;
            }
            getCenter() { return { x: this.x + this.width / 2, y: this.y + this.height / 2 }; }
            update() {
                let speed = keys['Shift'] ? PLAYER_SLOW_SPEED : PLAYER_SPEED;
                
                if (keys['w'] || keys['W'] || keys['ArrowUp']) this.y -= speed;
                if (keys['s'] || keys['S'] || keys['ArrowDown']) this.y += speed;
                if (keys['a'] || keys['A'] || keys['ArrowLeft']) this.x -= speed;
                if (keys['d'] || keys['D'] || keys['ArrowRight']) this.x += speed;

                this.x = Math.max(0, Math.min(this.x, WIDTH - this.width));
                this.y = Math.max(0, Math.min(this.y, HEIGHT - this.height));

                this.fireTimer++;
                // üöÄ „Éë„ÉØ„Éº„É¨„Éô„É´„Å´Âøú„Åò„Å¶ÈÄ£Â∞ÑÈÄüÂ∫¶„ÇíÈ´òÈÄüÂåñ
                const actualFireRate = Math.max(3, this.fireRate - powerLevel * 2);
                if (this.fireTimer >= actualFireRate && (keys['x'] || keys['X'])) {
                    this.fire();
                    this.fireTimer = 0;
                }
            }
            fire() { // ‚òÖÂº∑Âåñ: „Éë„ÉØ„Éº„Ç¢„ÉÉ„Éó„Å´Âøú„Åò„ÅüÂºæ„ÅÆÁô∫Â∞Ñ
                const center = this.getCenter();
                const bulletSpeed = 10;
                const bulletDamage = 1 + powerLevel * 0.5;

                // „É¨„Éô„É´0 (P0): ÂçòÁô∫
                bullets.push(new Bullet(center.x - 2, center.y, 0, bulletSpeed, bulletDamage));

                // „É¨„Éô„É´1‰ª•‰∏ä (P1): 2ÈÄ£Â∞Ñ
                if (powerLevel >= 1) {
                    bullets.push(new Bullet(center.x - 8, center.y, 0, bulletSpeed, bulletDamage));
                    bullets.push(new Bullet(center.x + 4, center.y, 0, bulletSpeed, bulletDamage));
                }
                
                // „É¨„Éô„É´2‰ª•‰∏ä (P2): 3ÈÄ£Â∞ÑÔºàÂ∫ÉÁØÑÂõ≤Ôºâ
                if (powerLevel >= 2) {
                    bullets.push(new Bullet(center.x - 12, center.y, -0.5, bulletSpeed, bulletDamage));
                    bullets.push(new Bullet(center.x, center.y, 0, bulletSpeed, bulletDamage));
                    bullets.push(new Bullet(center.x + 8, center.y, 0.5, bulletSpeed, bulletDamage));
                }
                
                // „É¨„Éô„É´3 (P3): 5ÈÄ£Â∞Ñ („Åï„Çâ„Å´Â∫ÉÁØÑÂõ≤)
                if (powerLevel >= 3) {
                    bullets.push(new Bullet(center.x - 16, center.y, -1.0, bulletSpeed, bulletDamage));
                    bullets.push(new Bullet(center.x + 12, center.y, 1.0, bulletSpeed, bulletDamage));
                }
            }
            draw() {
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x, this.y, this.width, this.height);

                if (keys['Shift']) {
                    const center = this.getCenter();
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.5)';
                    ctx.beginPath();
                    ctx.arc(center.x, center.y, this.hitboxRadius, 0, Math.PI * 2);
                    ctx.fill();
                }
            }
        }

        class Bullet {
            constructor(x, y, dx, speed, damage) {
                this.x = x; this.y = y;
                this.width = 4; this.height = 10;
                this.dx = dx;
                this.speed = speed;
                this.damage = damage; // ‚òÖËøΩÂä†: „ÉÄ„É°„Éº„Ç∏ÂÄ§
                this.color = 'white';
            }
            update() {
                this.y -= this.speed;
                this.x += this.dx;
                return this.y < 0; 
            }
            draw() {
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x, this.y, this.width, this.height);
            }
        }

        class Enemy { // ‚òÖÂº∑Âåñ: „Ç®„É™„Éº„ÉàÊïµ„Å®HP„Éê„Éº„Å´ÂØæÂøú
            constructor(x, y, type) {
                this.x = x; this.y = y;
                this.type = type; 
                
                if (type === 'elite') {
                    this.width = 30; this.height = 30;
                    this.health = 50 + currentWave * 15; // È´òËÄê‰πÖ
                    this.maxHealth = this.health;
                    this.speed = 0.8;
                    this.color = 'orange';
                    this.scoreValue = 500;
                    this.fireRate = 60; // ÊîªÊíÉÈ†ªÂ∫¶È´ò„ÇÅ
                } else { // 'normal'
                    this.width = 20; this.height = 20;
                    this.health = 10 + currentWave * 3;
                    this.maxHealth = this.health;
                    this.speed = 2 + currentWave * 0.1;
                    this.color = 'red';
                    this.scoreValue = 100;
                    this.fireRate = 120;
                }
                this.fireTimer = Math.random() * this.fireRate;
            }
            getCenter() { return { x: this.x + this.width / 2, y: this.y + this.height / 2 }; }
            update() {
                this.y += this.speed;
                
                this.fireTimer++;
                if (this.fireTimer >= this.fireRate) {
                    this.fire();
                    this.fireTimer = 0;
                }

                return this.y > HEIGHT || this.health <= 0;
            }
            fire() {
                const center = this.getCenter();
                const dx = player.getCenter().x - center.x;
                const dy = player.getCenter().y - center.y;
                const angle = Math.atan2(dy, dx);
                
                enemyBullets.push(new EnemyBullet(center.x, center.y, angle, 4));

                if (this.type === 'elite') {
                    // „Ç®„É™„Éº„ÉàÊïµ„ÅØÊã°Êï£Âºæ„ÇíÊíÉ„Å§
                    enemyBullets.push(new EnemyBullet(center.x, center.y, angle - 0.2, 4));
                    enemyBullets.push(new EnemyBullet(center.x, center.y, angle + 0.2, 4));
                }
            }
            draw() {
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x, this.y, this.width, this.height);
                
                // HP„Éê„Éº„ÅÆÊèèÁîª
                if (this.health < this.maxHealth) {
                    const hpRatio = this.health / this.maxHealth;
                    const barWidth = this.width;
                    ctx.fillStyle = 'black';
                    ctx.fillRect(this.x, this.y - 8, barWidth, 4);
                    ctx.fillStyle = hpRatio > 0.5 ? 'lime' : 'yellow';
                    ctx.fillRect(this.x, this.y - 8, barWidth * hpRatio, 4);
                }
            }
            dropItem() { // ‚òÖËøΩÂä†: „Ç¢„Ç§„ÉÜ„É†„Éâ„É≠„ÉÉ„Éó
                if (Math.random() < 0.3) { 
                    items.push(new Item(this.getCenter().x, this.getCenter().y, 'P'));
                }
            }
        }

        class EnemyBullet {
            constructor(x, y, angle, speed) {
                this.x = x; this.y = y;
                this.radius = 4;
                this.speed = speed;
                this.vx = Math.cos(angle) * speed;
                this.vy = Math.sin(angle) * speed;
                this.color = 'red';
            }
            update() {
                this.x += this.vx;
                this.y += this.vy;
                return this.x < -10 || this.x > WIDTH + 10 || this.y < -10 || this.y > HEIGHT + 10;
            }
            draw() {
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        class Item { // ‚òÖËøΩÂä†: „Ç¢„Ç§„ÉÜ„É†„ÇØ„É©„Çπ
            constructor(x, y, type) {
                this.x = x; this.y = y;
                this.type = type; 
                this.radius = 8;
                this.speed = 1.5;
                this.color = '#00FFFF'; // „Ç∑„Ç¢„É≥
            }
            getCenter() { return { x: this.x, y: this.y }; }
            update() {
                this.y += this.speed;
                return this.y > HEIGHT;
            }
            draw() {
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = 'black';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.font = 'bold 10px sans-serif';
                ctx.fillText(this.type, this.x, this.y + 1);
            }
            applyEffect() {
                if (this.type === 'P') {
                    powerLevel = Math.min(3, powerLevel + 1); // ÊúÄÂ§ßP3
                    score += 500;
                    updateUI();
                }
            }
        }


        // --- „Ç≤„Éº„É†ÁÆ°ÁêÜÈñ¢Êï∞ ---

        function initGame() {
            player = new Player();
            enemies = [];
            bullets = [];
            enemyBullets = [];
            items = [];
            score = 0;
            powerLevel = 0;
            currentWave = 1;
            gameStatus = 'playing';

            enemiesToSpawn = getWaveEnemyCount(currentWave);
            enemiesSpawned = 0;

            document.getElementById('game-over-screen').style.display = 'none';
            document.getElementById('GameCanvas').style.opacity = '1';
            updateUI();
        }
        
        function getWaveEnemyCount(wave) {
            return 10 + wave * 5; 
        }

        function updateGame() {
            // „Éó„É¨„Ç§„É§„Éº
            player.update();

            // Êïµ„ÅÆÂá∫Áèæ
            handleEnemySpawn(); // ‚òÖWave„Ç∑„Çπ„ÉÜ„É†„Å´ÂØæÂøú

            // Êïµ„ÅÆ„Ç¢„ÉÉ„Éó„Éá„Éº„Éà„Å®Èô§Âéª
            enemies = enemies.filter(enemy => {
                const removed = enemy.update();
                if (removed && enemy.health <= 0) { // ÊíÉÁ†¥„Åï„Çå„ÅüÊïµ„ÅÆ„Åø„Éâ„É≠„ÉÉ„ÉóÂà§ÂÆö
                    enemy.dropItem();
                }
                return !removed && enemy.health > 0;
            });

            // Âºæ„Å®„Ç¢„Ç§„ÉÜ„É†„ÅÆ„Ç¢„ÉÉ„Éó„Éá„Éº„Éà„Å®Èô§Âéª
            bullets = bullets.filter(bullet => !bullet.update());
            enemyBullets = enemyBullets.filter(bullet => !bullet.update());
            items = items.filter(item => !item.update()); // ‚òÖ„Ç¢„Ç§„ÉÜ„É†Êõ¥Êñ∞

            // Ë°ùÁ™ÅÂà§ÂÆö
            handleCollisions();
            
            // Wave„ÇØ„É™„Ç¢Âà§ÂÆö
            if (enemiesSpawned >= enemiesToSpawn && enemies.length === 0) {
                startNextWave();
            }
        }

        function handleEnemySpawn() { // ‚òÖWave„Ç∑„Çπ„ÉÜ„É†„Å´ÂØæÂøú
            if (enemiesSpawned < enemiesToSpawn) {
                enemySpawnTimer++;
                const spawnInterval = Math.max(30, 90 - currentWave * 5); 

                if (enemySpawnTimer >= spawnInterval) {
                    // Wave„ÅåÈÄ≤„ÇÄ„Åª„Å©„Ç®„É™„Éº„ÉàÊïµ„ÅÆÂá∫ÁèæÁéá„Åå‰∏ä„Åå„Çã
                    let eliteChance = 0.05 + currentWave * 0.02; 
                    let enemyType = (Math.random() < eliteChance) ? 'elite' : 'normal';
                    let x = Math.random() * (WIDTH - 50) + 25;
                    enemies.push(new Enemy(x, -50, enemyType));
                    enemiesSpawned++;
                    enemySpawnTimer = 0;
                }
            }
        }

        function handleCollisions() {
            const playerCenter = player.getCenter();
            // Shift„Ç≠„Éº„ÇíÊäº„Åó„Å¶„ÅÑ„Çã/„Çø„ÉÉ„ÉÅ„Éâ„É©„ÉÉ„Ç∞‰∏≠„ÅØÁ≤æÂØÜÂà§ÂÆö„ÄÅ„Åù„Çå‰ª•Â§ñ„ÅØÂ∫É„ÇÅ„ÅÆÂà§ÂÆö
            const playerHitboxRadius = keys['Shift'] ? player.hitboxRadius : player.width / 2 * 0.8;

            // „Éó„É¨„Ç§„É§„ÉºÂºæ„Å®Êïµ („ÉÄ„É°„Éº„Ç∏„Å®„Çπ„Ç≥„Ç¢Âá¶ÁêÜ„ÇíÂê´„ÇÄ)
            bullets = bullets.filter(bullet => {
                let hit = false;
                enemies.forEach(enemy => {
                    if (enemy.health > 0) {
                        const enemyCenter = enemy.getCenter();
                        const dist = Math.sqrt(Math.pow(bullet.x - enemyCenter.x, 2) + Math.pow(bullet.y - enemyCenter.y, 2));
                        
                        if (dist < enemy.width / 2 + 5) {
                            enemy.health -= bullet.damage;
                            hit = true;
                            if (enemy.health <= 0) {
                                score += enemy.scoreValue; // ‚òÖ„Çπ„Ç≥„Ç¢Âä†ÁÆó
                            }
                            updateUI();
                        }
                    }
                });
                return !hit;
            });

            // ÊïµÂºæ„Å®„Éó„É¨„Ç§„É§„Éº
            enemyBullets = enemyBullets.filter(bullet => {
                const dist = Math.sqrt(Math.pow(bullet.x - playerCenter.x, 2) + Math.pow(bullet.y - playerCenter.y, 2));
                if (dist < playerHitboxRadius + bullet.radius) {
                    gameOver();
                    return false; 
                }
                return true;
            });

            // „Ç¢„Ç§„ÉÜ„É†„Å®„Éó„É¨„Ç§„É§„Éº (Êé•Ëß¶„ÅßÂèñÂæó)
            items = items.filter(item => {
                const itemCenter = item.getCenter();
                const dist = Math.sqrt(Math.pow(itemCenter.x - playerCenter.x, 2) + Math.pow(itemCenter.y - playerCenter.y, 2));
                if (dist < item.radius + player.width / 2 * 0.8) {
                    item.applyEffect();
                    return false; // „Ç¢„Ç§„ÉÜ„É†„ÇíÂâäÈô§
                }
                return true;
            });
        }
        
        function startNextWave() { // ‚òÖWaveÈÄ≤Ë°åÂá¶ÁêÜ
            currentWave++;
            enemiesSpawned = 0;
            enemiesToSpawn = getWaveEnemyCount(currentWave);
            
            // ‰æã: WaveÈñãÂßãÊôÇ„ÅÆÈÄöÁü•„Å™„Å©„ÇíÂÖ•„Çå„Çã„Å®ÊºîÂá∫„ÅåËâØ„Åè„Å™„Çã
            // console.log(`WAVE ${currentWave} START!`);
            
            updateUI();
        }

        function gameOver() {
            gameStatus = 'gameover';
            document.getElementById('final-score-display').textContent = `ÊúÄÁµÇ„Çπ„Ç≥„Ç¢: ${score}`;
            
            // „Ç≤„Éº„É†„Ç™„Éº„Éê„ÉºÁîªÈù¢„Çí„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„Å™„Å©„ÅßÂº∑Ë™ø„Åó„Å¶„ÇÇËâØ„ÅÑ
            document.getElementById('game-over-screen').style.display = 'flex';
            document.getElementById('GameCanvas').style.opacity = '0.5';
        }

        function retryGame() {
            initGame();
            gameLoop();
        }

        // --- ÊèèÁîªÈñ¢Êï∞ ---

        function draw() {
            ctx.fillStyle = '#00001a'; ctx.fillRect(0, 0, WIDTH, HEIGHT);

            items.forEach(item => item.draw()); // ‚òÖ„Ç¢„Ç§„ÉÜ„É†ÊèèÁîª
            enemies.forEach(enemy => enemy.draw());
            enemyBullets.forEach(bullet => bullet.draw());
            bullets.forEach(bullet => bullet.draw());
            player.draw();
        }

        function updateUI() { // ‚òÖUIÊõ¥Êñ∞Èñ¢Êï∞
            document.getElementById('score-display').textContent = score;
            document.getElementById('power-display').textContent = `P${powerLevel}`;
            document.getElementById('wave-display').textContent = currentWave;
        }

        // --- „É°„Ç§„É≥„É´„Éº„Éó ---

        function gameLoop() {
            if (gameStatus === 'playing') {
                updateGame();
                draw();
            }

            requestAnimationFrame(gameLoop);
        }

        // --- Êìç‰Ωú„Ç§„Éô„É≥„Éà ---

        document.addEventListener('keydown', (e) => {
            if (['w', 'a', 's', 'd', 'x', 'W', 'A', 'S', 'D', 'X', 'Shift', 'ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                keys[e.key] = true;
                e.preventDefault(); 
            }
        });

        document.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });
        
        // --- „Çø„ÉÉ„ÉÅ/„Éâ„É©„ÉÉ„Ç∞Êìç‰Ωú (‚òÖËá™ÂãïÊîªÊíÉÊ©üËÉΩ„ÇíÁµÑ„ÅøËæº„Åø) ---
        let isDragging = false;
        let dragOffsetX, dragOffsetY;

        function getCanvasMousePosition(event) {
            const rect = canvas.getBoundingClientRect();
            let clientX, clientY;

            if (event.touches) {
                clientX = event.touches[0].clientX;
                clientY = event.touches[0].clientY;
            } else {
                clientX = event.clientX;
                clientY = event.clientY;
            }

            return {
                x: clientX - rect.left,
                y: clientY - rect.top
            };
        }

        function handleDragStart(event) {
            if (gameStatus !== 'playing') return;
            const pos = getCanvasMousePosition(event);
            
            const playerCenter = player.getCenter();
            dragOffsetX = pos.x - playerCenter.x;
            dragOffsetY = pos.y - playerCenter.y;
            
            isDragging = true;
            keys['Shift'] = true; // „Éâ„É©„ÉÉ„Ç∞‰∏≠„ÅØËá™ÂãïÁöÑ„Å´‰ΩéÈÄüÁßªÂãï„ÇíON
            keys['x'] = true;     // ‚òÖËøΩÂä†: „Éâ„É©„ÉÉ„Ç∞‰∏≠„ÅØËá™ÂãïÁöÑ„Å´ÊîªÊíÉ„ÇíON
            event.preventDefault(); 
        }

        function handleDragMove(event) {
            if (!isDragging || gameStatus !== 'playing') return;
            const pos = getCanvasMousePosition(event);
            
            let newX = pos.x - dragOffsetX - player.width / 2;
            let newY = pos.y - dragOffsetY - player.height / 2;

            newX = Math.max(0, Math.min(newX, WIDTH - player.width));
            newY = Math.max(0, Math.min(newY, HEIGHT - player.height));
            
            player.x = newX;
            player.y = newY;
            
            event.preventDefault(); 
        }

        function handleDragEnd() {
            isDragging = false;
            keys['Shift'] = false; // „Éâ„É©„ÉÉ„Ç∞ÁµÇ‰∫Ü„Åß‰ΩéÈÄüÁßªÂãï„ÇíOFF
            keys['x'] = false;     // ‚òÖËøΩÂä†: „Éâ„É©„ÉÉ„Ç∞ÁµÇ‰∫Ü„ÅßËá™ÂãïÊîªÊíÉ„ÇíOFF
        }

        // PCÂêë„Åë„Éû„Ç¶„Çπ„Ç§„Éô„É≥„Éà
        canvas.addEventListener('mousedown', handleDragStart);
        document.addEventListener('mousemove', handleDragMove);
        document.addEventListener('mouseup', handleDragEnd);

        // „Çπ„Éû„Éõ/„Çø„Éñ„É¨„ÉÉ„ÉàÂêë„Åë„Çø„ÉÉ„ÉÅ„Ç§„Éô„É≥„Éà
        canvas.addEventListener('touchstart', handleDragStart);
        document.addEventListener('touchmove', handleDragMove, { passive: false });
        document.addEventListener('touchend', handleDragEnd);

        // --- ÂàùÊúüÂåñ ---
        initGame();
        gameLoop();
    </script>
</body>
</html>
