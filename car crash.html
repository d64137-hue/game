<!DOCTYPE html>
<html>
<head>
    <title>Advanced Simple Road Racer</title>
    <style>
        /* ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚’ä¸­å¤®ã«é…ç½®ã™ã‚‹ãŸã‚ã®ã‚·ãƒ³ãƒ—ãƒ«ãªã‚¹ã‚¿ã‚¤ãƒ« */
        body { margin: 0; background-color: #222; display: flex; justify-content: center; align-items: center; height: 100vh; }
        canvas { border: 2px solid #555; background-color: #333; }
        #scoreDisplay { color: white; position: absolute; top: 10px; right: 10px; font-size: 20px; font-family: monospace; }
        #gameOverScreen {
            position: absolute;
            width: 300px;
            height: 500px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            display: none; /* åˆæœŸã¯éè¡¨ç¤º */
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-family: monospace;
            text-align: center;
        }
        #gameOverScreen button {
            padding: 10px 20px;
            margin-top: 20px;
            font-size: 16px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="300" height="500"></canvas>
    <div id="scoreDisplay">Score: 0</div>
    <div id="gameOverScreen">
        <h1>GAME OVER</h1>
        <p id="finalScore"></p>
        <button onclick="resetGame()">RESTART</button>
    </div>

    <script>
       const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const finalScoreDisplay = document.getElementById('finalScore');
        
        // --- ã‚²ãƒ¼ãƒ å®šæ•° ---
        const ROAD_COLOR = '#444';
        const ROAD_EDGE_COLOR = '#8B4513';
        const LINE_COLOR = 'white';
        const PLAYER_COLOR = 'blue';
        const ENEMY_COLOR = 'red';
        const PLAYER_MOVE_SPEED = 8;
        const ROAD_WIDTH = 250;
        const PASS_SCORE = 20;
        
        // --- é€Ÿåº¦åˆ¶å¾¡ã®å®šæ•°ã¨å¤‰æ•° ---
        let BASE_SCROLL_SPEED = 5;      // ğŸ‘ˆ åŸºæœ¬ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é€Ÿåº¦
        let ENEMY_SPEED_MULTIPLIER = 1; // ğŸ‘ˆ æ•µã®é€Ÿåº¦ã«ã‹ã‹ã‚‹å€ç‡ (æœ€åˆã¯1)
        const SPEED_INCREASE_THRESHOLD = 400; // ğŸ‘ˆ ã‚¹ã‚³ã‚¢ãŒ400å¢—ãˆã‚‹ãŸã³ã«é€Ÿåº¦ã‚¢ãƒƒãƒ—
        const SPEED_INCREASE_RATE = 1.2;      // ğŸ‘ˆ é€Ÿåº¦ã®å¢—åŠ å€ç‡
        let lastSpeedIncreaseScore = 0;   // æœ€å¾Œã«é€Ÿåº¦ãŒä¸ŠãŒã£ãŸæ™‚ã®ã‚¹ã‚³ã‚¢
        
        // --- ã‚²ãƒ¼ãƒ çŠ¶æ…‹ ---
        let scrollOffset = 0;
        let isMovingLeft = false;
        let isMovingRight = false;
        let score = 0;
        let isGameOver = false;
        let enemies = [];
        let enemySpawnTimer = 0;
        const ENEMY_SPAWN_RATE = 100;

        // --- è‡ªæ©Ÿ (ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼) ã®è¨­å®š ---
        const PLAYER_WIDTH = 30;
        const PLAYER_HEIGHT = 50;
        let playerX = (canvas.width / 2) - (PLAYER_WIDTH / 2); 
        const playerY = canvas.height - PLAYER_HEIGHT - 20; 
        
        // --------------------------------------------------------------------------
        // é–¢æ•°å®šç¾©
        // --------------------------------------------------------------------------

        // é“è·¯ã€è·¯è‚©ã€è»Šç·šã‚’æç”»
        function drawRoad() {
            const currentScrollSpeed = BASE_SCROLL_SPEED * ENEMY_SPEED_MULTIPLIER; // ç¾åœ¨ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é€Ÿåº¦
            
            // 1. è·¯è‚© (ç”»é¢å…¨ä½“)
            ctx.fillStyle = ROAD_EDGE_COLOR;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // 2. é“è·¯ (èµ°è¡Œã‚¨ãƒªã‚¢)
            const roadStartX = (canvas.width - ROAD_WIDTH) / 2;
            ctx.fillStyle = ROAD_COLOR;
            ctx.fillRect(roadStartX, 0, ROAD_WIDTH, canvas.height);

            // 3. ä¸­å¤®ã®ç‚¹ç·šã®æç”»
            ctx.fillStyle = LINE_COLOR;
            const lineWidth = 6;
            const lineGap = 20;
            const lineLength = 30;
            const roadCenterX = canvas.width / 2;

            for (let i = -1; i < canvas.height / (lineLength + lineGap) + 1; i++) {
                let y = (i * (lineLength + lineGap) + scrollOffset) % (canvas.height + lineLength + lineGap);
                if (y < 0) y += (canvas.height + lineLength + lineGap);

                ctx.fillRect(roadCenterX - lineWidth / 2, y, lineWidth, lineLength);
            }

            // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’æ›´æ–°ã—ã€ãƒ«ãƒ¼ãƒ—ã•ã›ã‚‹
            scrollOffset += currentScrollSpeed; // ğŸ‘ˆ é€Ÿåº¦ã‚’é©ç”¨
            if (scrollOffset >= lineLength + lineGap) {
                scrollOffset -= (lineLength + lineGap); 
            }
        }

        function drawPlayer() {
            ctx.fillStyle = PLAYER_COLOR;
            ctx.fillRect(playerX, playerY, PLAYER_WIDTH, PLAYER_HEIGHT);
        }

        function drawEnemies() {
            ctx.fillStyle = ENEMY_COLOR;
            enemies.forEach(enemy => {
                ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
            });
        }
        
        function updatePlayer() {
            if (isMovingLeft) {
                playerX -= PLAYER_MOVE_SPEED;
            }
            if (isMovingRight) {
                playerX += PLAYER_MOVE_SPEED;
            }

            const roadStartX = (canvas.width - ROAD_WIDTH) / 2;
            const roadEndX = roadStartX + ROAD_WIDTH;

            if (playerX < roadStartX) {
                playerX = roadStartX;
                gameOver();
            }
            if (playerX > roadEndX - PLAYER_WIDTH) {
                playerX = roadEndX - PLAYER_WIDTH;
                gameOver();
            }
        }

        // æ•µã®å‡ºç¾ã¨ç§»å‹•ã‚’æ›´æ–°
        function updateEnemies() {
            enemySpawnTimer++;
            if (enemySpawnTimer > ENEMY_SPAWN_RATE / ENEMY_SPEED_MULTIPLIER) { // ğŸ‘ˆ é€Ÿåº¦ã«å¿œã˜ã¦å‡ºç¾é »åº¦ã‚‚ä¸Šã’ã‚‹ï¼ˆé›£æ˜“åº¦èª¿æ•´ï¼‰
                spawnEnemy();
                enemySpawnTimer = 0;
            }

            enemies.forEach(enemy => {
                // æ•µè»Šä¸¡ã¯ã€(åŸºæœ¬ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é€Ÿåº¦ * å€ç‡) + (æ•µã®å›ºæœ‰é€Ÿåº¦ * å€ç‡) ã§ç§»å‹•
                const movementSpeed = BASE_SCROLL_SPEED * ENEMY_SPEED_MULTIPLIER + enemy.speed * ENEMY_SPEED_MULTIPLIER; 
                enemy.y += movementSpeed; 
                
                if (enemy.y > canvas.height && !enemy.passed) {
                    score += PASS_SCORE;
                    enemy.passed = true;
                    scoreDisplay.textContent = `Score: ${score}`;
                }
            });

            enemies = enemies.filter(enemy => enemy.y < canvas.height);
        }

        function spawnEnemy() {
            const ENEMY_WIDTH = 30;
            const ENEMY_HEIGHT = 40;
            const roadStartX = (canvas.width - ROAD_WIDTH) / 2;
            
            const randomX = roadStartX + Math.random() * (ROAD_WIDTH - ENEMY_WIDTH);

            enemies.push({
                x: randomX,
                y: -ENEMY_HEIGHT,
                width: ENEMY_WIDTH,
                height: ENEMY_HEIGHT,
                speed: Math.random() * 2, // æ•µã”ã¨ã®å›ºæœ‰ã®è¿½åŠ é€Ÿåº¦ (é€Ÿåº¦å€ç‡ã‚’ã‹ã‘ã‚‹å‰ã«æ±ºã¾ã‚‹)
                passed: false
            });
        }

        function checkCollisions() {
            const player = { x: playerX, y: playerY, w: PLAYER_WIDTH, h: PLAYER_HEIGHT };
            
            enemies.forEach(enemy => {
                if (player.x < enemy.x + enemy.width &&
                    player.x + player.w > enemy.x &&
                    player.y < enemy.y + enemy.height &&
                    player.y + player.h > enemy.y) {
                    
                    gameOver();
                }
            });
        }
        
        // ğŸ‘ˆ é›£æ˜“åº¦ã‚’ä¸Šã’ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã‚’ç®¡ç†ã™ã‚‹æ–°ã—ã„é–¢æ•°
        function manageDifficulty() {
            // ã‚¹ã‚³ã‚¢ãŒã—ãã„å€¤ã‚’è¶…ãˆã¦ã„ã¦ã€ã‹ã¤æœ€å¾Œã«é€Ÿåº¦ã‚¢ãƒƒãƒ—ã—ãŸã‚¹ã‚³ã‚¢ã¨ã®å·®ãŒ400ä»¥ä¸Šã‹
            if (score >= lastSpeedIncreaseScore + SPEED_INCREASE_THRESHOLD) {
                
                ENEMY_SPEED_MULTIPLIER *= SPEED_INCREASE_RATE; // é€Ÿåº¦å€ç‡ã‚’1.2å€ã«ã™ã‚‹
                lastSpeedIncreaseScore = Math.floor(score / SPEED_INCREASE_THRESHOLD) * SPEED_INCREASE_THRESHOLD;
                
                // (ã‚ªãƒ—ã‚·ãƒ§ãƒ³) é€Ÿåº¦ãŒä¸ŠãŒã£ãŸã“ã¨ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã«ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›
                console.log(`é€Ÿåº¦ã‚¢ãƒƒãƒ—! ã‚¹ã‚³ã‚¢: ${score}, æ–°ã—ã„å€ç‡: ${ENEMY_SPEED_MULTIPLIER.toFixed(2)}`);
            }
        }

        function gameOver() {
            if (isGameOver) return;
            isGameOver = true;
            cancelAnimationFrame(gameLoopHandle);
            
            finalScoreDisplay.textContent = `æœ€çµ‚ã‚¹ã‚³ã‚¢: ${score}`;
            gameOverScreen.style.display = 'flex';
        }

        function resetGame() {
            isGameOver = false;
            score = 0;
            playerX = (canvas.width / 2) - (PLAYER_WIDTH / 2);
            enemies = [];
            enemySpawnTimer = 0;
            
            // é€Ÿåº¦ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’åˆæœŸå€¤ã«æˆ»ã™ ğŸ‘ˆ ãƒªã‚»ãƒƒãƒˆæ™‚ã«é‡è¦
            ENEMY_SPEED_MULTIPLIER = 1;
            lastSpeedIncreaseScore = 0;
            
            gameOverScreen.style.display = 'none';
            scoreDisplay.textContent = `Score: 0`;
            gameLoop();
        }

        // --------------------------------------------------------------------------
        // ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—ã¨å…¥åŠ›å‡¦ç†
        // --------------------------------------------------------------------------
        let gameLoopHandle;

        function gameLoop() {
            if (isGameOver) return;

            // 1. æ›´æ–° (update)
            updatePlayer();
            updateEnemies();
            checkCollisions();
            manageDifficulty(); // ğŸ‘ˆ é›£æ˜“åº¦ç®¡ç†ã‚’ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—ã«è¿½åŠ 

            // 2. æç”» (draw)
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawRoad();
            drawEnemies();
            drawPlayer();

            gameLoopHandle = requestAnimationFrame(gameLoop);
        }

        // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰å…¥åŠ›ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        document.addEventListener('keydown', (e) => {
            if (isGameOver) return;
            if (e.key === 'ArrowLeft' || e.key === 'a') {
                isMovingLeft = true;
            } else if (e.key === 'ArrowRight' || e.key === 'd') {
                isMovingRight = true;
            }
        });

        document.addEventListener('keyup', (e) => {
            if (e.key === 'ArrowLeft' || e.key === 'a') {
                isMovingLeft = false;
            } else if (e.key === 'ArrowRight' || e.key === 'd') {
                isMovingRight = false;
            }
        });

        // ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆï¼
        gameLoop();
    </script>
</body>
</html>